name: Chocolatine
env:
      MIRROR_URL: ""
      EXECUTABLES: choco
on: 
  push:
    branches-ignore:
      - 'ga-ignore-*'
jobs:
  check_program_cleanless:
    runs-on: ubuntu-latest
    container:
      image: epitechcontent/epitest-docker:latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0
      - run: 'repo=.
        function check_file_in_folder()
        {
          for file in "$1"/*
          do
            if [ -f "$file" ]; then
              ext="${file##*.}"
              if [[ $ext != c ]] && [[ $ext != h ]] && [[ $file != *Makefile ]]; then
                echo 'Unwanted file detected: $file'
              fi
            fi
            if [ -d "$file" ]; then
              if [[ $file != bonus ]] && [[ $file != assets ]]; then
                check_file_in_folder $file
              fi
            fi
          done
        }

        check_file_in_folder $repo'
  check_program_compilation:
    needs:
      - check_program_cleanless
    runs-on: ubuntu-latest
    container:
      image: epitechcontent/epitest-docker:latest
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - run: make
    - run: make clean
    - run: for file in $EXECUTABLES; do test -f $file && echo '$file exist' ; done
  run_tests:
    needs:
      - check_program_compilation
    runs-on: ubuntu-latest
    container:
      image: epitechcontent/epitest-docker:latest
    timeout-minutes: 2
    steps:
    - uses : actions/checkout@v2
      with:
        fetch-depth: 0
    - run: make tests_run    
      